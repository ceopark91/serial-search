<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° | Serial Number Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0b1020;
  --card:#111a33;
  --line:#23305a;
  --text:#eaf0ff;
  --muted:#9aa7c2;
  --accent:#38bdf8;
  --danger:#fb7185;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:linear-gradient(180deg,#0b1020,#05070d);
  font-family: "Pretendard","Noto Sans KR",system-ui,Arial,sans-serif;
  color:var(--text);
}

.wrapper {
  max-width: 900px;
  margin: auto;
  padding: 32px 16px 80px;
}

header h1 {
  margin:0;
  font-size:26px;
  letter-spacing:-0.3px;
}

header p {
  margin:8px 0 24px;
  color:var(--muted);
  font-size:14px;
  line-height:1.5;
}

.search-box {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.search-box input {
  flex:1;
  min-width:240px;
  padding:14px 16px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#070a14;
  color:var(--text);
  font-size:16px;
}

.search-box button {
  padding:14px 18px;
  border-radius:12px;
  border:1px solid var(--accent);
  background:rgba(56,189,248,.15);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
}

.search-box button.reset {
  border-color:#374151;
  background:#1f2937;
}

.notice {
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
}

.result-area {
  margin-top:28px;
}

.card {
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
}

.card h2 {
  margin:0 0 14px;
  font-size:16px;
  display:flex;
  gap:8px;
  align-items:center;
}

.tag {
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--accent);
  color:var(--accent);
}

.row {
  display:grid;
  grid-template-columns: 170px 1fr;
  gap:8px 12px;
  margin-bottom:10px;
  font-size:14px;
}

.label {
  color:var(--muted);
}

.value {
  white-space:pre-wrap;
  word-break:break-word;
}

.empty {
  padding:20px;
  border-radius:14px;
  border:1px dashed var(--line);
  color:var(--danger);
  font-size:14px;
}

footer {
  margin-top:40px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}

@media (max-width:520px){
  .row { grid-template-columns:1fr; }
}
</style>
</head>

<body>
<div class="wrapper">

<header>
  <h1>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° (Serial Number Search)</h1>
  <p>
    êµ¬í˜• / ì‹ í˜• ì‹œíŠ¸ë¥¼ í†µí•© ê²€ìƒ‰í•©ë‹ˆë‹¤.<br>
    Search across legacy and current sheets.  
    Alphabet characters in specific positions of serial numbers are automatically ignored.
  </p>
</header>

<section class="search-box">
  <input id="serialInput" placeholder="ì˜ˆ: RD20D2560002 / RD202560002">
  <button onclick="search()">ê²€ìƒ‰ (Search)</button>
  <button class="reset" onclick="resetForm()">ì´ˆê¸°í™” (Reset)</button>
</section>

<div class="notice">
  â€¢ 4ë²ˆì§¸Â·5ë²ˆì§¸ ìœ„ì¹˜ì˜ ì˜ë¬¸ë§Œ ë¬´ì‹œ &nbsp; â€¢ ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë³µìˆ˜ S/N ì§€ì›
</div>

<section id="result" class="result-area"></section>

<footer>
  Â© SEDNAENG Â· Internal Serial Search Tool
</footer>

</div>

<script>
/* ================= ì„¤ì • ================= */
const SPREADSHEET_ID = "1S6NfRpDYdBJgnfdweINyqVs_NQhZi-T2uOABSx_3JnU";
const SHEETS = ["êµ¬í˜•","ì‹ í˜•"];

/*
ì—´ ì¸ë±ìŠ¤ (0ë¶€í„°)
A:0 B:1 C:2 D:3 E:4 F:5 G:6 H:7 I:8 J:9 K:10 L:11 ... R:17

D: ì—…ì²´ëª…
F: W/P ë‚©í’ˆì¼
H: ì œí’ˆ ë‚©í’ˆì¼
J: ëª¨ë¸ëª…
K: ë‚©ê¸° ìˆ˜ëŸ‰
L: í”„ë¡œì íŠ¸ëª…
R: S/N
*/
const COL = {
  company: 3,   // D
  wp: 5,        // F
  delivery: 7,  // H
  model: 9,     // J
  project: 11,  // L
  serial: 17    // R
};
const K_INDEX = 10; // Kì—´(ë‚©ê¸° ìˆ˜ëŸ‰)

/* ================= ìœ í‹¸ ================= */
function buildKey(raw){
  if (!raw) return "";
  let v = raw.toUpperCase().replace(/\s+/g, "").trim();
  let result = "";
  for (let i = 0; i < v.length; i++) {
    const ch = v[i];
    const pos = i + 1;
    if ((pos === 4 || pos === 5) && /[A-Z]/.test(ch)) continue;
    result += ch;
  }
  return result;
}

/* ================= ê²€ìƒ‰ ================= */
async function search(){
  const input = document.getElementById("serialInput").value;
  const resultBox = document.getElementById("result");
  resultBox.innerHTML = "";

  if(!input){
    resultBox.innerHTML = `<div class="empty">âš  ì‹œë¦¬ì–¼ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>`;
    return;
  }

  const key = buildKey(input);
  if(!key){
    resultBox.innerHTML = `<div class="empty">âš  ìœ íš¨í•œ ì‹œë¦¬ì–¼ ë„˜ë²„ê°€ ì•„ë‹™ë‹ˆë‹¤.</div>`;
    return;
  }

  let hits = [];

  try{
    for(const sheet of SHEETS){
      const url =
        `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${encodeURIComponent(sheet)}&tqx=out:json`;
      const txt  = await fetch(url).then(r=>r.text());
      const json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}")+1));
      const rows = json.table.rows || [];

      rows.forEach(r=>{
        const row = r.c.map(c => c ? c.v : "");
        const serials = (row[COL.serial] || "")
          .toString()
          .split(",")
          .map(s => buildKey(s))
          .filter(s => s);

        if (serials.some(s => s === key)) {
          hits.push({sheet, row});
        }
      });
    }

    if(hits.length === 0){
      resultBox.innerHTML =
        `<div class="empty">âŒ '${input}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    hits.forEach(hit=>{
      const row = hit.row;
      resultBox.innerHTML += `
      <div class="card">
        <h2>ğŸ” ê²€ìƒ‰ ê²°ê³¼ <span class="tag">${hit.sheet}</span></h2>

        <div class="row">
          <div class="label">ì—…ì²´ëª…</div>
          <div class="value">${row[COL.company] ?? "-"}</div>
        </div>

        <div class="row">
          <div class="label">ë‚©í’ˆì¼</div>
          <div class="value">${row[COL.delivery] ?? "-"}</div>
        </div>

        <div class="row">
          <div class="label">W/P ë‚©í’ˆì¼</div>
          <div class="value">${row[COL.wp] ?? "-"}</div>
        </div>

        <div class="row">
          <div class="label">ëª¨ë¸ëª…</div>
          <div class="value">${row[COL.model] ?? "-"}</div>
        </div>

        <div class="row">
          <div class="label">ë‚©ê¸° ìˆ˜ëŸ‰</div>
          <div class="value">${row[K_INDEX] ?? "-"}</div>
        </div>

        <div class="row">
          <div class="label">í”„ë¡œì íŠ¸ëª…</div>
          <div class="value">${row[COL.project] ?? "-"}</div>
        </div>
      </div>`;
    });

  }catch(e){
    console.error(e);
    resultBox.innerHTML =
      `<div class="empty">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (ì‹œíŠ¸ ê³µê°œ ì—¬ë¶€ / ID / ì‹œíŠ¸ëª… í™•ì¸ í•„ìš”)</div>`;
  }
}

function resetForm(){
  document.getElementById("serialInput").value = "";
  document.getElementById("result").innerHTML = "";
}
</script>

</body>
</html>
