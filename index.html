<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° (Serial Number Search)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #1a2a4f, #050b1c);
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: 80px auto;
      padding: 40px;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 32px;
    }
    .sub {
      color: #b8c3ff;
      margin-bottom: 30px;
    }
    .search-box {
      display: flex;
      gap: 10px;
    }
    input {
      flex: 1;
      padding: 14px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    button {
      padding: 14px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 15px;
    }
    .btn-search {
      background: #2563eb;
      color: #fff;
    }
    .btn-reset {
      background: #374151;
      color: #fff;
    }
    .hint {
      margin-top: 12px;
      font-size: 13px;
      color: #9ca3af;
    }
    .result {
      margin-top: 30px;
      padding: 24px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      white-space: pre-wrap;
      line-height: 1.6;
    }
    .error {
      color: #ff6b6b;
    }
    footer {
      margin-top: 60px;
      text-align: center;
      font-size: 13px;
      color: #9ca3af;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° (Serial Number Search)</h1>
    <div class="sub">
      êµ¬í˜• / ì‹ í˜• í†µí•© ë°ì´í„° ê²€ìƒ‰<br>
      Alphabet characters in serial numbers are automatically ignored.
    </div>

    <div class="search-box">
      <input id="keyword" placeholder="ì˜ˆ: RF152511004, DM152203104" />
      <button class="btn-search" onclick="search()">ê²€ìƒ‰ (Search)</button>
      <button class="btn-reset" onclick="reset()">ì´ˆê¸°í™” (Reset)</button>
    </div>

    <div class="hint">
      â€¢ ì˜ë¬¸ ìë™ ì œê±° (Alphabet ignored)<br>
      â€¢ ì½¤ë§ˆ ì‹œë¦¬ì–¼ ì§€ì› (Comma supported)
    </div>

    <div id="result" class="result"></div>

    <footer>
      Â© SEDNAENG Â· Internal Serial Search Tool
    </footer>
  </div>

<script>
/* ===========================
   ğŸ”§ í™˜ê²½ ì„¤ì •
=========================== */
const SPREADSHEET_ID = "1S6NfRpDYdBJgnfdweINyqVs_NQhZi-T2uOABSx_3JnU";
const SHEET_NAME = "RAW_ALL";

/* RAW_ALL ì»¬ëŸ¼ êµ¬ì¡°
A ì—…ì²´ëª…
B W/P ë‚©í’ˆì¼
C ë‚©í’ˆì¼
D í”„ë¡œì íŠ¸
E ëª¨ë¸ëª…
F S/N
*/
const COL = {
  company: 0,
  wp: 1,
  delivery: 2,
  project: 3,
  model: 4,
  serial: 5
};

/* ===========================
   ğŸ” ìœ í‹¸
=========================== */
function normalizeSerial(v) {
  return String(v || "")
    .toUpperCase()
    .replace(/[A-Z]/g, "")
    .replace(/\s+/g, "");
}

/* ===========================
   ğŸ” ê²€ìƒ‰
=========================== */
async function search() {
  const input = document.getElementById("keyword").value.trim();
  const resultBox = document.getElementById("result");

  if (!input) {
    resultBox.innerHTML = "<span class='error'>âš  ì‹œë¦¬ì–¼ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</span>";
    return;
  }

  const target = normalizeSerial(input);

  try {
    const url =
      `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    let hits = [];

    rows.forEach(r => {
      if (!r.c || !r.c[COL.serial]) return;

      const serials = String(r.c[COL.serial].v || "")
        .split(",")
        .map(s => normalizeSerial(s));

      if (serials.includes(target)) {
        hits.push({
          company: r.c[COL.company]?.v || "-",
          wp: r.c[COL.wp]?.v || "-",
          delivery: r.c[COL.delivery]?.v || "-",
          project: r.c[COL.project]?.v || "-",
          model: r.c[COL.model]?.v || "-"
        });
      }
    });

    if (!hits.length) {
      resultBox.innerHTML = `<span class="error">âŒ '${input}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>`;
      return;
    }

    resultBox.innerHTML = hits.map((h, i) => `
ğŸ“Œ ìš”ì²­í•˜ì‹  '${input}' ê²€ìƒ‰ ê²°ê³¼ (${i + 1})
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¢ ì—…ì²´ëª… (Company) : ${h.company}
ğŸ“¦ W/P ë‚©í’ˆì¼ (W/P Date) : ${h.wp}
ğŸšš ë‚©í’ˆì¼ (Delivery Date) : ${h.delivery}
ğŸ“¦ ëª¨ë¸ëª… (Model) : ${h.model}
ğŸ›  í”„ë¡œì íŠ¸ ì‚¬ì–‘ (Project) :
${h.project}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
`).join("\n");

  } catch (e) {
    resultBox.innerHTML = "<span class='error'>âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ (ì‹œíŠ¸ ê³µìœ /ID í™•ì¸)</span>";
  }
}

function reset() {
  document.getElementById("keyword").value = "";
  document.getElementById("result").innerHTML = "";
}
</script>
</body>
</html>
