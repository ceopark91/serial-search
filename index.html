<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: "Pretendard", Arial, sans-serif;
      background: linear-gradient(180deg, #0b1220, #05070d);
      color: #fff;
      padding: 30px;
    }

    .wrap {
      max-width: 820px;
      margin: auto;
    }

    h1 {
      margin-bottom: 8px;
    }

    .desc {
      color: #9aa4b2;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .search-box {
      display: flex;
      gap: 10px;
    }

    input {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    button {
      padding: 14px 18px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      background: #2563eb;
      color: white;
    }

    button.reset {
      background: #374151;
    }

    .result {
      margin-top: 24px;
      padding: 18px;
      border-radius: 12px;
      background: #0f172a;
      border: 1px solid #1e293b;
      white-space: pre-line;
    }

    .error {
      color: #f87171;
    }

    .success {
      color: #a7f3d0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸°</h1>
    <div class="desc">
      êµ¬í˜• / ì‹ í˜• ì‹œíŠ¸ë¥¼ í†µí•© ê²€ìƒ‰í•©ë‹ˆë‹¤.<br>
      ì‹œë¦¬ì–¼ì— ì˜ë¬¸ì´ í¬í•¨ë˜ì–´ë„ ìë™ ì œê±° í›„ ê²€ìƒ‰í•©ë‹ˆë‹¤.
    </div>

    <div class="search-box">
      <input id="serialInput" placeholder="ì˜ˆ: DM15D2203104" />
      <button onclick="search()">ê²€ìƒ‰</button>
      <button class="reset" onclick="resetForm()">ì´ˆê¸°í™”</button>
    </div>

    <div id="result" class="result"></div>
  </div>

<script>
/************** ì„¤ì • **************/
const SPREADSHEET_ID = "1S6NfRpDYdBJgnfdweINyqVs_NQhZi-T2uOABSx_3JnU";
const TARGET_SHEETS = ["êµ¬í˜•", "ì‹ í˜•"];

/************** ìœ í‹¸ **************/
function normalizeSerial(v) {
  return v
    .toUpperCase()
    .replace(/[A-Z]/g, "") // ì˜ë¬¸ ì œê±°
    .replace(/\s+/g, "")
    .trim();
}

/************** ê²€ìƒ‰ **************/
async function search() {
  const input = document.getElementById("serialInput").value;
  const resultBox = document.getElementById("result");

  if (!input) {
    resultBox.innerHTML = `<span class="error">âš  ì‹œë¦¬ì–¼ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</span>`;
    return;
  }

  const keyword = normalizeSerial(input);
  let results = [];

  try {
    for (const sheet of TARGET_SHEETS) {
      const url =
        `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?` +
        `sheet=${encodeURIComponent(sheet)}&tqx=out:json`;

      const text = await fetch(url).then(r => r.text());

      // GViz JSONP ê»ë°ê¸° ì œê±°
      const json = JSON.parse(
        text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1)
      );

      const rows = json.table.rows;

      rows.forEach(r => {
        const serialCell = r.c[17]?.v; // Rì—´
        if (!serialCell) return;

        const serials = serialCell
          .split(",")
          .map(s => normalizeSerial(s));

        if (serials.includes(keyword)) {
          results.push({
            company: r.c[3]?.v || "-",
            wpDate: r.c[5]?.v || "-",
            delivery: r.c[7]?.v || "-",
            spec: r.c[11]?.v || "-"
          });
        }
      });
    }

    if (results.length === 0) {
      resultBox.innerHTML = `<span class="error">âŒ '${input}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>`;
      return;
    }

    resultBox.innerHTML =
      `<div class="success">ğŸ” ìš”ì²­í•˜ì‹  '${input}' ê²€ìƒ‰ê²°ê³¼</div>\n\n` +
      results.map(r => `
ğŸ¢ ì—…ì²´ëª… : ${r.company}
ğŸ“¦ W/P ë‚©í’ˆì¼ : ${r.wpDate}
ğŸšš ë‚©í’ˆì¼ : ${r.delivery}
ğŸ›  í”„ë¡œì íŠ¸ ì‚¬ì–‘ :
${r.spec}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      `).join("\n");

  } catch (e) {
    resultBox.innerHTML =
      `<span class="error">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨<br>${e.message}</span>`;
  }
}

function resetForm() {
  document.getElementById("serialInput").value = "";
  document.getElementById("result").innerHTML = "";
}
</script>

</body>
</html>
