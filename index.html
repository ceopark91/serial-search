<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° | Serial Number Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0b1020;
  --card:#111a33;
  --line:#23305a;
  --text:#eaf0ff;
  --muted:#9aa7c2;
  --accent:#38bdf8;
  --danger:#fb7185;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:linear-gradient(180deg,#0b1020,#05070d);
  font-family: "Pretendard","Noto Sans KR",system-ui,Arial,sans-serif;
  color:var(--text);
}

.wrapper {
  max-width: 900px;
  margin: auto;
  padding: 32px 16px 80px;
}

header h1 {
  margin:0;
  font-size:26px;
  letter-spacing:-0.3px;
}

header p {
  margin:8px 0 24px;
  color:var(--muted);
  font-size:14px;
  line-height:1.5;
}

.search-box {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.search-box input {
  flex:1;
  min-width:240px;
  padding:14px 16px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#070a14;
  color:var(--text);
  font-size:16px;
}

.search-box button {
  padding:14px 18px;
  border-radius:12px;
  border:1px solid var(--accent);
  background:rgba(56,189,248,.15);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
}

.search-box button.reset {
  border-color:#374151;
  background:#1f2937;
}

.notice {
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
}

.result-area {
  margin-top:28px;
}

.card {
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
}

.card h2 {
  margin:0 0 14px;
  font-size:16px;
  display:flex;
  gap:8px;
  align-items:center;
}

.tag {
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--accent);
  color:var(--accent);
}

.row {
  display:grid;
  grid-template-columns: 170px 1fr;
  gap:8px 12px;
  margin-bottom:10px;
  font-size:14px;
}

.label {
  color:var(--muted);
}

.value {
  white-space:pre-wrap;
  word-break:break-word;
}

.spec {
  margin-top:14px;
  padding-top:12px;
  border-top:1px dashed var(--line);
  font-size:14px;
}

.empty {
  padding:20px;
  border-radius:14px;
  border:1px dashed var(--line);
  color:var(--danger);
  font-size:14px;
}

footer {
  margin-top:40px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}

@media (max-width:520px){
  .row { grid-template-columns:1fr; }
}
</style>
</head>

<body>
<div class="wrapper">

<header>
  <h1>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° (Serial Number Search)</h1>
  <p>
    êµ¬í˜• / ì‹ í˜• ì‹œíŠ¸ë¥¼ í†µí•© ê²€ìƒ‰í•©ë‹ˆë‹¤.<br>
    Search across legacy and current sheets.  
    Alphabet characters in serial numbers are automatically ignored.
  </p>
</header>

<section class="search-box">
  <input id="serialInput" placeholder="ì˜ˆ: DM15B2203104 / DM152203104">
  <button onclick="search()">ê²€ìƒ‰ (Search)</button>
  <button class="reset" onclick="resetForm()">ì´ˆê¸°í™” (Reset)</button>
</section>

<div class="notice">
  â€¢ ì˜ë¬¸ ìë™ ì œê±° (Alphabet ignored) &nbsp; â€¢ ì½¤ë§ˆ ì‹œë¦¬ì–¼ ì§€ì› (Comma supported)
</div>

<section id="result" class="result-area"></section>

<footer>
  Â© SEDNAENG Â· Internal Serial Search Tool
</footer>

</div>

<script>
/* ================= ì„¤ì • ================= */
const SPREADSHEET_ID = "1S6NfRpDYdBJgnfdweINyqVs_NQhZi-T2uOABSx_3JnU";
const SHEETS = ["êµ¬í˜•","ì‹ í˜•"];

/* RAW_ALL QUERY ì»¬ëŸ¼ ìˆœì„œ
0 ì—…ì²´ëª… | 1 W/P | 2 ë‚©í’ˆì¼ | 3 ì‚¬ì–‘ | 4 ëª¨ë¸ëª… | 5 ì‹œë¦¬ì–¼
*/
const COL = {
  company:0,
  wp:1,
  delivery:2,
  spec:3,
  model:4,
  serial:5
};

/* ================= ìœ í‹¸ ================= */
function normalize(v){
  return v.toUpperCase().replace(/[A-Z]/g,"").replace(/\s+/g,"").trim();
}

/* ================= ê²€ìƒ‰ ================= */
async function search(){
  const input = document.getElementById("serialInput").value;
  const resultBox = document.getElementById("result");
  resultBox.innerHTML = "";

  if(!input){
    resultBox.innerHTML = `<div class="empty">âš  ì‹œë¦¬ì–¼ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>`;
    return;
  }

  const key = normalize(input);
  let hits = [];

  try{
    for(const sheet of SHEETS){
      const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${sheet}&tqx=out:json`;
      const txt = await fetch(url).then(r=>r.text());
      const json = JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
      const rows = json.table.rows || [];

      rows.forEach(r=>{
        const row = r.c.map(c=>c?c.v:"");
        const serials = row[COL.serial]?.split(",").map(s=>normalize(s));
        if(serials?.includes(key)) hits.push(row);
      });
    }

    if(hits.length===0){
      resultBox.innerHTML = `<div class="empty">âŒ '${input}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    hits.forEach(row=>{
      resultBox.innerHTML += `
      <div class="card">
        <h2>ğŸ” ê²€ìƒ‰ ê²°ê³¼ <span class="tag">MATCH</span></h2>

        <div class="row">
          <div class="label">ëª¨ë¸ëª… (Model)</div>
          <div class="value">${row[COL.model]||"-"}</div>
        </div>

        <div class="row">
          <div class="label">ì—…ì²´ëª… (Company)</div>
          <div class="value">${row[COL.company]||"-"}</div>
        </div>

        <div class="row">
          <div class="label">W/P ë‚©í’ˆì¼ (W/P Delivery)</div>
          <div class="value">${row[COL.wp]||"-"}</div>
        </div>

        <div class="row">
          <div class="label">ë‚©í’ˆì¼ (Delivery Date)</div>
          <div class="value">${row[COL.delivery]||"-"}</div>
        </div>

        <div class="spec">
          <b>í”„ë¡œì íŠ¸ ì‚¬ì–‘ (Project Specification)</b>
          <pre>${row[COL.spec]||"-"}</pre>
        </div>
      </div>`;
    });

  }catch(e){
    resultBox.innerHTML = `<div class="empty">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>`;
  }
}

function resetForm(){
  document.getElementById("serialInput").value="";
  document.getElementById("result").innerHTML="";
}
</script>

</body>
</html>
