<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° | Serial Number Search</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0b1020;
  --card:#111a33;
  --line:#23305a;
  --text:#eaf0ff;
  --muted:#9aa7c2;
  --accent:#38bdf8;
  --danger:#fb7185;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:linear-gradient(180deg,#0b1020,#05070d);
  font-family:"Pretendard","Noto Sans KR",system-ui,Arial,sans-serif;
  color:var(--text);
}

.wrapper {
  max-width:900px;
  margin:auto;
  padding:32px 16px 80px;
}

header h1 {
  margin:0;
  font-size:26px;
}

header p {
  margin:8px 0 24px;
  color:var(--muted);
  font-size:14px;
}

.search-box {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.search-box input {
  flex:1;
  min-width:240px;
  padding:14px 16px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#070a14;
  color:var(--text);
  font-size:16px;
}

.search-box button {
  padding:14px 18px;
  border-radius:12px;
  border:1px solid var(--accent);
  background:rgba(56,189,248,.15);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
}

.search-box button.reset {
  border-color:#374151;
  background:#1f2937;
}

.notice {
  margin-top:14px;
  font-size:13px;
  color:var(--muted);
}

.result-area {
  margin-top:28px;
}

.card {
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  padding:18px;
  margin-bottom:16px;
}

.card h2 {
  margin:0 0 14px;
  font-size:16px;
  display:flex;
  gap:8px;
  align-items:center;
}

.tag {
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid var(--accent);
  color:var(--accent);
}

.row {
  display:grid;
  grid-template-columns:170px 1fr;
  gap:8px 12px;
  margin-bottom:10px;
  font-size:14px;
}

.label { color:var(--muted); }
.value { white-space:pre-wrap; word-break:break-word; }

.empty {
  padding:20px;
  border-radius:14px;
  border:1px dashed var(--line);
  color:var(--danger);
  font-size:14px;
}

footer {
  margin-top:40px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}
</style>
</head>

<body>
<div class="wrapper">

<header>
  <h1>ì‹œë¦¬ì–¼ ë„˜ë²„ ê²€ìƒ‰ê¸° (Serial Number Search)</h1>
  <p>
    êµ¬í˜• / ì‹ í˜• ì‹œíŠ¸ë¥¼ í†µí•© ê²€ìƒ‰í•©ë‹ˆë‹¤.<br>
    Search across legacy and current sheets.
  </p>
</header>

<section class="search-box">
  <input id="serialInput" placeholder="ì˜ˆ: DM222510125">
  <button onclick="search()">ê²€ìƒ‰</button>
  <button class="reset" onclick="resetForm()">ì´ˆê¸°í™”</button>
</section>

<section id="result" class="result-area"></section>

<footer>Â© SEDNAENG</footer>
</div>

<script>
/* ===== ì„¤ì • ===== */
const SPREADSHEET_ID = "1S6NfRpDYdBJgnfdweINyqVs_NQhZi-T2uOABSx_3JnU";
const SHEETS = ["êµ¬í˜•","ì‹ í˜•"];
const GRADE_SHEET = "ì„±ì ì„œ";

const COL = {
  company: 3,
  wp: 5,
  delivery: 7,
  model: 9,
  project: 11,
  serial: 17
};
const K_INDEX = 10;

/* ===== ìœ í‹¸ ===== */
function buildKey(raw){
  if(!raw) return "";
  let v = raw.toUpperCase().replace(/\s+/g,"");
  let out = "";
  for(let i=0;i<v.length;i++){
    const pos=i+1, ch=v[i];
    if((pos===4||pos===5)&&/[A-Z]/.test(ch)) continue;
    out+=ch;
  }
  return out;
}

/* ===== ì„±ì ì„œ ë§µ ===== */
async function loadGradeMap(){
  const url=`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${encodeURIComponent(GRADE_SHEET)}&tqx=out:json`;
  const txt=await fetch(url).then(r=>r.text());
  const json=JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
  const rows=json.table.rows||[];
  const map=new Map();

  rows.forEach(r=>{
    const row=r.c.map(c=>c?c.v:"");
    const serials=(row[2]||"").toString().split(",").map(buildKey);
    const url=row[3];
    serials.forEach(s=>{ if(s && url) map.set(s,url); });
  });
  return map;
}

/* ===== ê²€ìƒ‰ ===== */
async function search(){
  const input=document.getElementById("serialInput").value;
  const box=document.getElementById("result");
  box.innerHTML="";

  const key=buildKey(input);
  if(!key){
    box.innerHTML=`<div class="empty">ì‹œë¦¬ì–¼ ì…ë ¥ í•„ìš”</div>`;
    return;
  }

  const gradeMap=await loadGradeMap();
  let hits=[];

  for(const sheet of SHEETS){
    const url=`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?sheet=${sheet}&tqx=out:json`;
    const txt=await fetch(url).then(r=>r.text());
    const json=JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
    const rows=json.table.rows||[];

    rows.forEach(r=>{
      const row=r.c.map(c=>c?c.v:"");
      const serials=(row[COL.serial]||"").toString().split(",").map(buildKey);
      serials.forEach(s=>{
        if(s===key){
          hits.push({sheet,row,matchedSerial:s});
        }
      });
    });
  }

  if(!hits.length){
    box.innerHTML=`<div class="empty">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>`;
    return;
  }

  hits.forEach(hit=>{
    const gUrl=gradeMap.get(hit.matchedSerial)||"";
    box.innerHTML+=`
    <div class="card">
      <h2>ğŸ” ê²€ìƒ‰ ê²°ê³¼ <span class="tag">${hit.sheet}</span></h2>

      <div class="row"><div class="label">ì—…ì²´ëª…</div><div class="value">${hit.row[COL.company]||"-"}</div></div>
      <div class="row"><div class="label">ë‚©í’ˆì¼</div><div class="value">${hit.row[COL.delivery]||"-"}</div></div>
      <div class="row"><div class="label">W/P ë‚©í’ˆì¼</div><div class="value">${hit.row[COL.wp]||"-"}</div></div>
      <div class="row"><div class="label">ëª¨ë¸ëª…</div><div class="value">${hit.row[COL.model]||"-"}</div></div>
      <div class="row"><div class="label">ë‚©ê¸° ìˆ˜ëŸ‰</div><div class="value">${hit.row[K_INDEX]||"-"}</div></div>
      <div class="row"><div class="label">í”„ë¡œì íŠ¸ëª…</div><div class="value">${hit.row[COL.project]||"-"}</div></div>

      <div class="row">
        <div class="label">ì„±ì ì„œ</div>
        <div class="value">
          ${gUrl
            ? `<a href="${gUrl}" target="_blank">${hit.matchedSerial} ì„±ì ì„œ ë‹¤ìš´ë¡œë“œ</a>`
            : `${hit.matchedSerial} ë¯¸ë“±ë¡`
          }
        </div>
      </div>
    </div>`;
  });
}

function resetForm(){
  document.getElementById("serialInput").value="";
  document.getElementById("result").innerHTML="";
}
</script>
</body>
</html>
